import{c as n,r as a,j as e}from"./index-03mpuTXX.js";import{I as R}from"./image-DY1kTid7.js";import{F as z}from"./file-text-mPJjuUoJ.js";const F=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],S=n("circle-check-big",F);const P=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],I=n("database",P);const q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],E=n("info",q);const A=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],D=n("monitor",A);const H=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],O=n("pause",H);const T=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],V=n("play",T);const W=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],B=n("server",W);const K=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],X=n("upload",K);const Z=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],G=n("video",Z);const J=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Q=n("x",J),Y=50*1024;function ae(){const[d,j]=a.useState(null),[o,b]=a.useState(null),[g,u]=a.useState("other"),[i,f]=a.useState([]),[c,k]=a.useState(0),[p,m]=a.useState(!1),[ee,y]=a.useState(!1),[v,w]=a.useState(null),x=a.useRef(!1),C=t=>{const s=t.target.files[0];s&&(_(),j(s),s.type.startsWith("image/")?(u("image"),b(URL.createObjectURL(s))):s.type.startsWith("video/")?(u("video"),b(URL.createObjectURL(s))):u("other"))},M=(t,s=Y)=>{const r=[];let l=0;for(;l<t.size;)r.push({index:r.length,file:t.slice(l,l+s),uploaded:!1}),l+=s;return r},U=t=>new Promise((s,r)=>{const h=Math.random()>.1?Math.random()*80+20:Math.random()*300+200;setTimeout(()=>{x.current?r("paused"):s(t.index)},h)}),$=async()=>{if(!d)return;m(!0),y(!1),x.current=!1;let t=i;t.length===0&&(t=M(d),f(t));const s=t.filter(r=>!r.uploaded);try{for(const r of s){if(x.current)break;await U(r),f(l=>{const h=[...l];return h[r.index]={...h[r.index],uploaded:!0},h})}}catch{console.log("Upload paused")}finally{x.current||m(!1)}},L=()=>{y(!0),m(!1),x.current=!0},N=t=>{const s=t.target,r=s.videoWidth||s.naturalWidth,l=s.videoHeight||s.naturalHeight;r&&l&&w(`${r} × ${l}`)};a.useEffect(()=>{if(i.length===0)return;const t=i.filter(r=>r.uploaded).length,s=Math.ceil(t/i.length*100);k(s)},[i]),a.useEffect(()=>()=>{o&&URL.revokeObjectURL(o)},[o]);const _=()=>{j(null),o&&URL.revokeObjectURL(o),b(null),u("other"),f([]),k(0),m(!1),y(!1),w(null)};return e.jsxs("div",{className:"max-w-[1600px] mx-auto p-4 md:p-6 h-[calc(100vh-88px)]",children:[e.jsx("header",{className:"mb-4 flex justify-center items-center",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100 flex items-center justify-center gap-3",children:["文件传输控制台",e.jsx("span",{className:"text-xs font-mono font-normal text-blue-600 bg-blue-50 dark:bg-blue-900/40 px-2 py-1 rounded border border-blue-200 dark:border-blue-800",children:"Dashboard"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"大文件分片并行上传演示 / 实时监控 / 自适应预览"})]})}),e.jsxs("div",{className:"lg:grid-cols-12 gap-6 max-h-[600px]",children:[e.jsxs("div",{className:"lg:col-span-5 flex gap-4",children:[!d&&e.jsxs("div",{className:"w-[600px] h-[300px] border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-10 text-center bg-gray-50 dark:bg-gray-800 hover:border-blue-500 hover:bg-blue-50/50 transition-all cursor-pointer relative group flex flex-col items-center justify-center",children:[e.jsx("input",{type:"file",onChange:C,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600 mb-4 group-hover:scale-110 transition-transform",children:e.jsx(X,{size:32})}),e.jsx("h3",{className:"text-lg font-bold text-gray-700 dark:text-gray-200",children:"点击或拖拽文件上传"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"支持超大视频、高清图片"})]}),d&&e.jsxs("div",{className:"w-[600px] h-[300px] bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 dark:bg-blue-900/20 rounded-xl flex items-center justify-center shrink-0 text-blue-600 border border-blue-100 dark:border-blue-800",children:g==="video"?e.jsx(G,{size:32}):g==="image"?e.jsx(R,{size:32}):e.jsx(z,{size:32})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 leading-tight break-all",children:d.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-500 mt-2",children:[e.jsxs("span",{className:"bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded text-gray-600 dark:text-gray-300 font-mono",children:[(d.size/1024/1024).toFixed(2)," MB"]}),e.jsxs("span",{className:"flex items-center gap-1 text-gray-400",children:[e.jsx(I,{size:12}),i.length," Chunks"]})]})]}),e.jsx("button",{onClick:_,className:"text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(Q,{size:24})})]})})]}),e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm font-bold text-gray-700 dark:text-gray-300",children:[e.jsx("span",{children:p?"传输中...":c===100?"传输完成":"就绪"}),e.jsxs("span",{className:"font-mono text-blue-600",children:[c,"%"]})]}),e.jsx("div",{className:"h-4 w-full bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden border border-gray-100 dark:border-gray-700",children:e.jsx("div",{className:`h-full transition-all duration-300 ease-out shadow-sm relative overflow-hidden ${c===100?"bg-green-500":"bg-blue-600"}`,style:{width:`${c}%`},children:p&&e.jsx("div",{className:"absolute inset-0 bg-white/20 w-full h-full animate-[shimmer_2s_infinite] skew-x-[-20deg]"})})})]}),e.jsx("div",{className:"mt-6 grid grid-cols-2 gap-4",children:c<100?p?e.jsxs("button",{onClick:L,className:"col-span-2 flex justify-center items-center gap-2 px-6 py-4 bg-amber-500 hover:bg-amber-600 text-white rounded-xl text-base font-bold transition-all shadow-lg shadow-amber-500/20",children:[e.jsx(O,{size:20,fill:"currentColor"}),"暂停上传"]}):e.jsxs("button",{onClick:$,className:"col-span-2 flex justify-center items-center gap-2 px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-base font-bold transition-all shadow-lg shadow-blue-600/20",children:[e.jsx(V,{size:20,fill:"currentColor"}),c>0?"继续上传":"开始极速上传"]}):e.jsxs("div",{className:"col-span-2 flex justify-center items-center gap-2 px-6 py-4 bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 rounded-xl text-base font-bold border border-green-200 dark:border-green-800",children:[e.jsx(S,{size:24}),"校验完成"]})})]}),e.jsxs("div",{className:"flex-1 h-[300px] bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl p-5 shadow-sm flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(B,{size:14}),"Chunk Map"]}),e.jsxs("span",{className:"text-xs text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",children:[i.filter(t=>t.uploaded).length," / ",i.length]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 scrollbar-thin",children:e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(10px,1fr))] gap-1",children:i.map(t=>e.jsx("div",{title:`Chunk #${t.index}`,className:`aspect-square rounded-[2px] transition-colors duration-200 ${t.uploaded?"bg-green-500":"bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`},t.index))})})]})]}),e.jsx("div",{className:"lg:col-span-7 h-full flex flex-col items-center justify-center p-4 relative mt-10",children:o?e.jsxs("div",{className:"relative shadow-2xl rounded-lg overflow-hidden bg-black max-w-full border border-gray-800",children:[v&&e.jsxs("div",{className:"absolute top-3 right-3 z-10 px-2 py-1 bg-black/70 backdrop-blur-md rounded text-[10px] text-white/90 font-mono flex items-center gap-1 border border-white/10 shadow-lg",children:[e.jsx(E,{size:10}),v]}),g==="video"?e.jsx("video",{src:o,controls:!0,className:"max-h-[calc(100vh-140px)] w-auto max-w-full block",onLoadedMetadata:N}):g==="image"?e.jsx("img",{src:o,alt:"Preview",className:"max-h-[calc(100vh-140px)] w-auto max-w-full block object-contain",onLoad:N}):e.jsxs("div",{className:"w-96 h-64 flex flex-col items-center justify-center text-gray-500 bg-white dark:bg-gray-800",children:[e.jsx(z,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{children:"不支持预览"})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-400 opacity-50",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-3xl flex items-center justify-center mb-6",children:e.jsx(D,{size:48,className:"opacity-40"})}),e.jsx("p",{className:"text-lg font-medium",children:"等待文件输入..."})]})})]})]})}export{ae as default};
